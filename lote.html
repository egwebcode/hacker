<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Consulta CPF em Lote</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, Helvetica, sans-serif;
  background:#f2f2f2;
  margin:0;
  padding:30px;
}
.container{
  background:#fff;
  max-width:1100px;
  margin:auto;
  padding:25px;
  border:1px solid #ccc;
}
h1{
  margin:0 0 10px;
  text-align:center;
}
textarea{
  width:100%;
  padding:10px;
  font-family: Consolas, monospace;
  font-size:14px;
}
#lista{ height:180px; }
#saida, #logs{
  height:320px;
  overflow:auto;
  white-space:pre-wrap;
}
#saida{
  background:#111;
  color:#eee;
}
#logs{
  background:#fafafa;
  border:1px solid #ccc;
  margin-top:10px;
  font-size:13px;
}
button{
  padding:10px 15px;
  margin:6px 4px 0 0;
  cursor:pointer;
}
.status{
  margin-top:10px;
  font-size:14px;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
}
@media(max-width:900px){
  .grid{ grid-template-columns:1fr; }
}
</style>
</head>
<body>

<div class="container">
<h1>Consulta CPF em Lote</h1>

<label>Cole os CPFs (um por linha – aceita com ou sem caracteres)</label>
<textarea id="lista" placeholder="000.790.814-72&#10;00179081453"></textarea>

<div>
  <button onclick="consultar()">Consultar</button>
  <button onclick="copiar()">Copiar Resultado</button>
  <button onclick="baixar()">Baixar TXT</button>
  <button onclick="limpar()">Limpar</button>
</div>

<div class="status" id="status">
  Total: 0 | Sucesso: 0 | Erro: 0
</div>

<div class="grid">
  <div>
    <h3>Resultado Final</h3>
    <pre id="saida"></pre>
  </div>

  <div>
    <h3>Logs</h3>
    <pre id="logs"></pre>
  </div>
</div>

</div>

<script>
const saida = document.getElementById('saida');
const logs = document.getElementById('logs');
const statusEl = document.getElementById('status');

let total = 0, ok = 0, erro = 0;

function log(msg){
  const time = new Date().toLocaleTimeString();
  logs.textContent += `[${time}] ${msg}\n`;
  logs.scrollTop = logs.scrollHeight;
}

function atualizarStatus(){
  statusEl.textContent = `Total: ${total} | Sucesso: ${ok} | Erro: ${erro}`;
}

async function consultar(){
  const linhas = document.getElementById('lista').value
    .split('\n')
    .map(l => l.replace(/\D/g, '')) // remove caracteres
    .filter(l => l.length === 11);

  if(linhas.length === 0){
    alert('Nenhum CPF válido encontrado.');
    return;
  }

  // reset
  saida.textContent = '';
  logs.textContent = '';
  total = linhas.length;
  ok = 0;
  erro = 0;
  atualizarStatus();

  log(`Iniciando consulta de ${total} CPFs`);

  for(const cpf of linhas){
    log(`Consultando CPF ${cpf}`);

    try{
      const req1 = fetch(
        'https://corsproxy.io/?https://donald.bet.br/api/documents/validate',
        {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({ number: cpf, captcha_token:"" })
        }
      );

      const req2 = fetch(
        'https://corsproxy.io/?https://bateu.bet.br/api/bff/address-by-cpf',
        {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({ cpf: cpf })
        }
      );

      const [res1, res2] = await Promise.all([req1, req2]);

      const json1 = await res1.json();
      const json2 = await res2.json();

      const finalJson = {
        validate: json1?.data || json1,
        address: json2
      };

      saida.textContent +=
        JSON.stringify(finalJson, null, 2) +
        '\n--------------------------------------\n';

      ok++;
      log(`CPF ${cpf} consultado com sucesso`);

    }catch(e){
      erro++;
      log(`ERRO no CPF ${cpf}: ${e}`);
    }

    atualizarStatus();
  }

  log('Consulta finalizada');
}

function copiar(){
  navigator.clipboard.writeText(saida.textContent);
  alert('Resultado copiado!');
}

function baixar(){
  const blob = new Blob([saida.textContent], {type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'resultado_cpfs.txt';
  a.click();
}

function limpar(){
  document.getElementById('lista').value = '';
  saida.textContent = '';
  logs.textContent = '';
  total = ok = erro = 0;
  atualizarStatus();
}
</script>

</body>
</html>
